#!/bin/sh

INPUT=${LIVE_BASE}${LIVE_CHANN_ID}
echo "Removing ${DIR} files"
rm -f ${DIR}/*
echo "Streaming $INPUT"

ffmpeg -analyzeduration 3000000 -f mpegts -i "$INPUT" -map_metadata -1 -map_chapters -1 -threads 0 -sn  -codec:v:0 libx264  -preset veryfast -crf 23 -maxrate 3000k  -bufsize 6000k  -profile:v high -level 4.1 -x264opts:0 subme=0:me_range=4:rc_lookahead=10:me=dia:no_chroma_me:8x8dct=0:partitions=none -force_key_frames "expr:gte(t,n_forced*3)" -vf yadif=0:-1:0  -codec:a:0 libmp3lame -ac 2 -ab 192000 -f hls -max_delay 5000000 -avoid_negative_ts disabled -start_at_zero  -hls_time 2  -hls_flags delete_segments  -hls_list_size 3  -hls_segment_filename "${DIR}/${LIVE_CHANN_ID}-%04d.ts"  -y  "${DIR}/stream.m3u8"
